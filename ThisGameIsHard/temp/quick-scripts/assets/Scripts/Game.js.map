{"version":3,"sources":["Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["import {ColorScheme} from \"./Objects/ColorScheme\"\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.scheme = new ColorScheme();\r\n        var lastScheme = localStorage.getItem(\"lastScheme\");\r\n        if(lastScheme != null)\r\n        {\r\n            this.scheme.loadSchemeFromInt(parseInt(lastScheme));\r\n            \r\n        }else\r\n        {\r\n            var to = (Math.floor(Math.random() * ColorScheme.numSchemes));\r\n            localStorage.setItem(\"lastScheme\", to + \"\");\r\n            this.scheme.loadSchemeFromInt(to);\r\n        }\r\n        var bar = this.node.getChildByName(\"progressBar\");\r\n\r\n\r\n        var progress = bar.getComponent(cc.ProgressBar);\r\n        progress.totalLength = this.node.width;\r\n        bar.setPosition((-(this.node.width / 2)) + bar.width / 2, 0);\r\n    }\r\n    getBallRepAsSF(sprite:cc.Sprite, id:string)\r\n    {\r\n        var reso = \"\";\r\n        cc.loader.loadRes(\"Balls/\"+id, function (err, res) {\r\n            if(!err)\r\n            {\r\n                cc.log(\"Resource Loaded!\")\r\n                reso = res;\r\n                sprite.spriteFrame = new cc.SpriteFrame(res);\r\n            }else\r\n            {\r\n                cc.log(err.message);\r\n            }\r\n        });\r\n    }\r\n    inSession:boolean = true;\r\n\r\n    gameEnd:boolean = false;\r\n\r\n    sessionTimer:number = 0.00;\r\n\r\n    scheme:ColorScheme = null;\r\n    skins =\r\n    {\r\n        Version:0.00,\r\n        CurBall: \"000\",\r\n    }\r\n    user =\r\n    {\r\n        HighScore: 0.00,\r\n        Count:0,\r\n        Coins:0,\r\n        TotalTime:0,\r\n    }\r\n    start () {\r\n        this.inSession = true;\r\n        this.sessionTimer = 0.00;\r\n        \r\n        if(localStorage.getItem(\"userData\") != null)\r\n        {\r\n            this.user = JSON.parse(localStorage.getItem(\"userData\"));\r\n        }\r\n        if(localStorage.getItem(\"skins\") != null)\r\n        {\r\n            this.skins = JSON.parse(localStorage.getItem(\"skins\"));\r\n        }else\r\n        {\r\n            localStorage.setItem(\"skins\", JSON.stringify(this.skins));\r\n        }\r\n        this.getBallRepAsSF(this.node.getChildByName(\"Ball\").getComponent(cc.Sprite), this.skins.CurBall);\r\n        this.node.getChildByName(\"CoinCnt\").getComponent(cc.Label).string = \"$\"+this.user.Coins;\r\n        this.scheme.loadColors(this.node);\r\n    }\r\n    addCoin(c:number)\r\n    {\r\n        this.user.Coins += c;\r\n        this.node.getChildByName(\"CoinCnt\").getComponent(cc.Label).string = \"$\"+this.user.Coins;\r\n    }\r\n\r\n    actions:Array<cc.Action> = null;\r\n    pause()\r\n    {\r\n        this.freeze();\r\n        this.node.getChildByName(\"Paused_Message\").getComponent(cc.RichText).string = \r\n        \"<color=#\" + this.scheme.toHex(this.scheme.curScheme.Secondary) + \">Paused...</color>\";\r\n        this.fade(15);\r\n        var Resume = this.node.getComponentInChildren(\"RestartControl\");\r\n        Resume.switchModes(1);\r\n        Resume.node.runAction(cc.fadeIn(0.25));\r\n        this.node.getChildByName(\"Menu\").runAction(cc.fadeIn(0.25));\r\n    }\r\n    fade(o)\r\n    {\r\n        var chw = this.node.getComponentsInChildren(\"FadeElem\");\r\n        for(var i = 0; i < chw.length; i++)\r\n        {\r\n            chw[i].fade(o);\r\n        }\r\n    }\r\n\r\n    unfade()\r\n    {\r\n        var chw = this.node.getComponentsInChildren(\"FadeElem\");\r\n        for(var i = 0; i < chw.length; i++)\r\n        {\r\n            chw[i].unFade();\r\n        }\r\n    }\r\n    unpause()\r\n    {\r\n        cc.director.getActionManager().resumeTargets(this.actions);\r\n        this.inSession = true;\r\n        this.node.getChildByName(\"Paused_Message\").getComponent(cc.RichText).string = \"\";\r\n        this.unfade();\r\n        this.node.getChildByName(\"Menu\").runAction(cc.fadeOut(0.125));\r\n        this.node.getChildByName(\"Resume\").runAction(cc.fadeOut(0.125));\r\n    }\r\n\r\n    freeze()\r\n    {\r\n        this.actions = cc.director.getActionManager().pauseAllRunningActions();\r\n        this.inSession = false;\r\n    }\r\n    gameOver() {\r\n        cc.log(\"Game End!\");\r\n        this.gameEnd = true;\r\n        this.freeze();\r\n        this.fade(0);\r\n        this.node.getChildByName(\"Paused_Message\").getComponent(cc.RichText).string = \r\n        \"<color=#\" + this.scheme.toHex(this.scheme.curScheme.Secondary) + \">Game Over</color>\";\r\n\r\n        localStorage.setItem(\"lastScheme\", (Math.floor(Math.random() * ColorScheme.numSchemes)) + \"\");\r\n        \r\n        this.user.Count = this.user.Count + 1;\r\n        this.user.TotalTime = this.user.TotalTime + this.sessionTimer;\r\n        this.updatePlayer();\r\n\r\n        var Resume = this.node.getChildByName(\"Resume\");\r\n        Resume.getComponent(\"RestartControl\").switchModes(0);\r\n        Resume.runAction(cc.fadeIn(0.25));\r\n        this.node.getChildByName(\"Menu\").runAction(cc.fadeIn(0.25));\r\n    }\r\n    updatePlayer()\r\n    {\r\n        cc.sys.localStorage.setItem(\"userData\", JSON.stringify(this.user));\r\n    }\r\n    restart()\r\n    {\r\n        this.updatePlayer();\r\n        cc.director.loadScene(\"PlayScene\");\r\n    }\r\n\r\n    menu()\r\n    {\r\n        this.node.runAction(cc.sequence( \r\n            cc.fadeOut(0.25), \r\n            cc.callFunc(function () {\r\n                cc.director.loadScene(\"MainMenu\");\r\n            })\r\n        ));\r\n    }\r\n    update (dt) {\r\n        if(this.inSession)\r\n        {\r\n            this.sessionTimer += dt;\r\n            this.node.getChildByName(\"Timer\").getComponent(cc.RichText).string = \"<color=#\" +  this.scheme.toHex(this.scheme.curScheme.Secondary) + \">Time:\" + this.sessionTimer.toFixed(2) + \"</color>\";\r\n            this.node.getChildByName(\"HighScore\").getComponent(cc.RichText).string = \"<color=#\" + this.scheme.toHex(this.scheme.curScheme.Secondary) + \">High: \" + this.user.HighScore.toFixed(2) + \"</color>\";\r\n            if(this.sessionTimer > this.user.HighScore)\r\n            {\r\n                this.user.HighScore = this.sessionTimer;\r\n                \r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]}